<div class="apartment-show-container">

  <% if @apartment.photo.attached? %>
    <div class="main-photo-wrapper">
      <%= image_tag @apartment.photo, alt: @apartment.title %>
    </div>
  <% end %>

  <div class="show-content-grid">

    <div class="description-section">
      <h1><%= @apartment.title %></h1>
      <p class="address"><%= @apartment.address %></p>

      <h3>Description</h3>
      <p><%= @apartment.description %></p>

<div class="mt-4 pt-3 border-top">
  <% if user_signed_in? && current_user.host? && current_user == @apartment.host %>
    <%= link_to "Edit apartment", edit_apartment_path(@apartment), class: "btn btn-outline-secondary me-2" %>
  <% end %>
  <%= link_to "Back", apartments_path, class: "btn btn-light" %>
</div>
    </div>

<div class="details-card">
      <h2>Details</h2>

      <div class="detail-line">
        <span class="detail-label"><i class="bi bi-people-fill"></i> Guests</span>
        <span class="detail-value"><%= @apartment.guests %></span>
      </div>

      <div class="detail-line price">
        <span class="detail-label"><i class="bi bi-tag-fill"></i> Night rate</span>
        <span class="detail-value"><%= number_to_currency(@apartment.price, unit: "â‚¬", separator: ",", delimiter: ".") %></span>
      </div>

      <% if user_signed_in? && current_user.tenant? %>
        <div class="booking-form-container mt-4">
          <h3>Book this apartment</h3>

          <%# Visualizzazione Errori di validazione %>
          <% if @booking && @booking.errors.any? %>
            <div class="alert alert-danger">
              <ul>
                <% @booking.errors.full_messages.each do |message| %>
                  <li><%= message %></li>
                <% end %>
              </ul>
            </div>
          <% end %>

          <%# Unico form corretto %>
          <%= form_with model: [@apartment, @booking], local: true do |f| %>
            <div class="form-group mb-2">
              <%= f.label :start_date %>
              <%= f.date_field :start_date, min: Date.today, class: "form-control", required: true %>
            </div>

            <div class="form-group mb-2">
              <%= f.label :end_date %>
              <%= f.date_field :end_date, min: Date.today + 1, class: "form-control", required: true %>
            </div>

            <%= f.submit "Book now", class: "btn btn-primary w-100 mt-2" %>
          <% end %>
        </div>

      <% elsif !user_signed_in? %>
        <div class="mt-4">
          <p class="text-muted">Please <%= link_to "log in", new_user_session_path %> to book this apartment.</p>
        </div>
      <% end %>

    </div> <%# Chiusura details-card %>
  </div> <%# Chiusura show-content-grid %>
</div> <%# Chiusura apartment-show-container %>
